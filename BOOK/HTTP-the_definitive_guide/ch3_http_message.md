HTTP 메세지
===========

#### 이번장을 통해서 알게되는것

-	메세지가 어떻게 흘러가는가
-	HTTP 메세지의 세부분 (시작줄 , 헤더 , 개체 본문)
-	요청과 응답 메세지의 차이
-	요청 메세지가 지원하는 여러 기능(메서드)
-	응답 메세지가 반환하는 여러 상태 코드들
-	여러 HTTP 헤더들을 무슨 일을 하는가

메세지의 흐름
-------------

메세지가 클라이언트에서 서버쪽으로 가는 방향을 `인바운드`라고 하고 , 서버에서 클라이언트에게 응답하는 방향을 `아웃바운드`라고 한다.

```
**요청 메세지의 형식**
<메서드> <요청 URL> <버전>
<헤더>

<엔터티 본문>

**응답 메세지의 형식**
<버전> <상태 코드> <사유 구절>
<헤더>

<엔터티 본문>

```

-	메서드 GET POST HEAD 등등 한 단어로 되어있다.<br>
-	요청 URL 요청 대상이 되는 리소스를 지칭하는 완전한 URL 혹은 경로이다. 서버에서는 생략된 URL이 자신을 가리키는것으로 간주한다.<br>
-	버전 이 메시지에서 사용 중인 HTTP 버전이다. 형식은 `HTTP/<메이저>.<마이너>`<br>
-	상태 코드 요청중에 무엇이 일어났는지 설명하는 세 자리의 숫자.<br>
-	사유 구절 상태 코드의 의미를 사람이 이해할수 있도록 나타내주는 짧은 문구, 상태코드부터 줄바꿈 준자열 까지가 사유 구절이다.<br>
-	헤더들 이름 , 콜론 , 선택적인 공백 , 값 , CRLF(줄바꿈) 가 순서대로 나타나는 0개 이상의 헤더들<br>
-	엔터티 본문 임의의 데이터 블록으로 없을 수도 있다.<br>

#### 시작줄

요청과 응답 메세지 모두 시작줄의 모든 필드는 공백으로 구분한다.

###### 메서드

요청의 시작줄은 메서드로 시작하며, 서버에게 무엇을 해야하는지 말해준다.

| 메서드  | 설명                                                    | 메세지 본문이 있는가? |
|:--------|:--------------------------------------------------------|:----------------------|
| GET     | 서버에서 어떤 문서를 가져온다.                          | 없음                  |
| HEAD    | 서버에서 어떤 문서에 대해 헤더만 가져온다.              | 없음                  |
| POST    | 서버가 처리해야 할 데이터를 보낸다.                     | 있음                  |
| PUT     | 서버에 요청 메세지의 본문을 저장한다.                   | 있음                  |
| TRACE   | 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적한다. | 없음                  |
| OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인한다.         | 없음                  |
| DELETE  | 서버에서 문서를 제거한다.                               | 없음                  |

*대표적인 메서드들만 적어 놓았고 , 다른 서버는 그들만의 확장 메서드를 사용할 가능성도 있다.*

###### 상태 코드

메서드가 서버에 무엇을 해야 하는지 말해주는 것처럼, 상태 코드는 클라이언트에게 무엇이 일어났는지 말해준다.

| 전체 범위 | 정의된 범위 | 분류            |
|-----------|-------------|-----------------|
| 100 - 199 | 100 - 101   | 정보            |
| 200 - 299 | 200 - 206   | 성공            |
| 300 - 399 | 300 - 305   | 리다이렉션      |
| 400 - 499 | 400 - 415   | 클라이언트 에러 |
| 500 - 599 | 500 - 505   | 서버 에러       |

*자주 쓰이는 상태코드 3개*

| 상태 코드 |  사유 구절  |   의미  |
| ----------- | ----------- | ----------- |
| 200 | OK        | 성공! 요청한 모든 데이터는 응답 본문에 들어있다. |
| 401 | Unauthorized    | 사용자 이름과 비밀번호를 입력해야 한다. |
| 404 | Not Found     | 서버는 요청한 URL에 해당하는 리소스를 찾지 못했다. |

#### 헤더

각 HTTP 헤더는 간단한 문법을 가진다. 이름, 쉼표, 공백(없어도 된다), 필드 값, CRLF(줄바꿈) 의 순서로 온다.

#### 엔터티 본문

엔터티 본문은 http 메시지의 화물이다. 이 메시지는 이미지 , 비디오 , html문서 등 여러 종류의 데이터를 실어 나를 수 있다.

메서드
------

상단에 있는 표에 몇가지 메서드들에 대해서 정리해보자

-	GET

가장 흔히 쓰이는 메서드로 주로 서버에 리소스를 달라고 요청하기 위해 쓰인다. HTTP/1.1은 서버가 이 메서드를 구현할 것을 요구한다.

-	HEAD

정확히 GET 처럼 동작하지만 엔터티 본문은 결코 반환되지 않는다. 헤더만을 조사할 수 있도록 사용된다. 이를 통한 이점은

1.	리소스를 가져오지 않고도 그에 대해 무엇인가를 알아낼 수 있다.
2.	응답의 상태코드를 통해, 개체가 존재하는지 확인할 수 있다.
3.	헤더를 확인하여 리소스가 변경되었는지 검사할 수 있다.

서버 개발자들은 HEAD를 통해 반환되는 헤더가 GET과 일치하는지 반드시 확인 하여야 한다.

-	PUT

서버에 문서를 쓰는 메서드 , 이 메서드의 의미는 서버가 요천의 본문을 가지고 요청 URL 이름대로 새 문서를 만들거나, 이미 URL이 존재한다면 , 본문을 사용해서 교체하는 것이다.

- POST

서버에 입력 데이터를 전송하기 위해 설계되었다. 실제로 HTML 폼을 지원하기 위해 흔히 사용된다.

- TRACE

이 메서드는 클라이언트에게 자ㅏ신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려준다. 목적지 서버에서 루프백을 진단하고 , 마지막단 서버는 자신이 받은 요청 메세지를 본문에 넣어 TRACE 응답을 되돌려준다.

- DELETE

서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요청한다.

## 상태 코드

#### 100-199 정보성 상태 코드


| 상태 코드 | 사유 구절 | 의미 |
| --- | --- | --- |
| 100 | Continue | 요청의 시작부분 일부가 받아들여졌으며 , 클라이언트는 나머지를 계속 이어서 보내야 함을 의미한다. 이것을 보낸 후 , 서버는 반드시 요청을 받아 응답해야 한다. |

약간 혼란스러운 100 continue 상태 코드는 서버에 엔터티 본문을 전송하기 전에 본문을 서버가 받아들일 것인지 확인 하려고 할때 , 그 작업을 최적화 하기 위해서 도입하였으나 오히려 프로그래머를 혼란스럽게 하는 경향이 있다.

클라이언트는 100-continue expect 요청 헤더를 보내야 한다. 만약에 클라이언트가 엔터티를 보내지 않으려 한다면 , 이 헤더를 보내면 안된다. 서버가 다룰수 없는 데이터를 확인하기 위해서 사용된다.

서버는 100-continue expect 요청을 받았다면 , 반드시 100 continue 상태 코드를 반환해야 한다.

#### 200-299 성공 상태 코드

| 상태 코드 | 사유 구절 | 의미 |
| --- | --- | --- |
| 200 | OK | 요청은 정상이고, 엔터티 본문은 요청된 리소스를 포함하고 있다. |
| 201 | Created | 서버 개체를 생성하라는 요청을 위한 상태 코드 , 서버는 상태 코드를 보내기에 앞서 반드시 객체를 생성해야 한다. |
| 202 | Accepted | 요청은 받아들여졌으나 서버는 아직 그에 대한  |
| 203 | Non-Authorized Information | 중개자가 리소스의 사본을 갖고 있었지만 리소스에 대한 메타 정보를 검증하지 못한 경우. |
| 204 | No Content | 응답 메시지가 헤데와 상태줄을 포함하고 있지만 본문은 포함하지 않는다. |
| 205 | Reset Content | 브라우저에게 현재 페이지에 있는 HTML form 값을 비우라고 말한다. |
| 206 | Partial Content | 부분 혹은 범위 요청이 성공했다. |

#### 300-399 리다이렉션 상태 코드

클라이언트가 관심있는 리소스에 대한 응답을 제공한다. Location 헤더를 통해 알아서 새 위치로 이동할 수 있게끔 한다.

| 상태 코드 | 사유 구절 | 의미 |
| --- | --- | --- |
| 300 | Multiple Choice | 클라이언트가 동시에 여러 리소스를 가리키는 URL을 요청한 경우 (다국어) |
| 301 | Move Permanently | 요청한 URL이 옮겨졌을 경우 , Loction 헤더에 현재 리소스가 존재하는 URL을 알려준다.|
| 302 | Found | 301과 같지만 , Location 헤더에 주어진 URL 리소스를 임시로 가리키기 위한 목적으로 사용된다. |
| 303 | See Other | 클라이언트에게 리소스를 다른 URL 에서 가져와야 한다고 말해준다. 새 URL은 Location 헤더에 있다. |
| 304 | Not Modified | 클라이언트는 헤더를 이용해 조건부 요청을 만들 수 있다. 응답은 본문을 가져와서는 안된다. |
| 305 | Use Proxy | 리소스가 반드시 프락시를 통해서 접근 되어야 함을 나타낸다. |
| 306 |  | 사용되지 않음 |
| 307 | Temparary Redirect | 301 상태 코드와 비슷하다. |

비슷한 부분들은 HTTP/1.0 과 HTTP/1.1 의 차이 때문에 나타난다. 따라서 적절한 상태 코드를 보내고 싶다면 , HTTP 버전을 먼저 확인해야 할 것이다.

#### 400-499 클라이언트 에러 상태 코드

| 상태 코드 | 사유 구절 | 의미 |
| --- | --- | --- |
| 400 | Bad Request | 클라이언트가 잘못된 요청을 보냈을때 |
| 401 | Unauthorized | 인증을 요구할때 적절한 헤더와 반환한다 |
| 402 |  | 현재 사용되지 않음 |
| 403 | Forbidden | 요청이 서버에 의해 거부되었음을 알려주기 위해서 사용한다. |
| 404 | Not Found | 서버가 요청한 URL을 찾을 수 없을 때 사용한다. |
| 405 | Method Not Allowed | 요청한 URL에 대해, 지원하지 않는 메서드로 요청 받았을 때 사용한다. ( 요청에 Allow 헤더를 포함하는 것이 좋다. )|
| 406 | Not Acceptable | 주어진 ㅇURL에 대한 리소스중 클라이언트가 받아들일 수 있는것이 없는 경우 사용한다. |
| 407 | Proxy Authentication Required | 401 코와 같다 , 프락시 인증을 요구할때 사용한다. |
| 408 | Request Timeout | 요청을 완수하기에 시간이 너무 많이 걸리는 경우 이 코드를 반환하고 연결을 끊을 수 있다. |
| 409 | Conflict | 요청이 충돌을 일으킬 수 있ㄷ고 판단했을때 이 코드를 사용한다. |
| 410 | Gone | 404와 비슷하지만 , 한때 이 리소스를 갖고 있었다는 것을 말해주기 위해 사용한다. |
| 411 | Length Required | 요청 메세지에 Content-Length 헤더가 있을 경우 사용된다. |
| 412 | Precondition Failed | 조건부 요청을 했는데 그중에 일부가 실패한 경우 |
| 413 | Request Entity Too Large | 서버가 처리할수 있는 한계를 넘은 요청이 들어왔을때 |
| 414 | Request URI Too Long | URI가 너무 길어서 서버에서 처리를 못하는 경우 |
| 415 | Unsupported Media Type | 서버가 이해하지 못하거나 지원하지 못하는 내용 유형의 엔터티를 클라이언트가 보냈을때  |
| 416 | Requested Range Not Satisfiable | 특정 리소스의 범위를 요청했는데 , 범위가 잘못되었을 경우 |
| 417 | Expectation Failed | Expect 요청 헤더에 만족시킬 수 없는 경우 사용한다. |

#### 500-599 서버 에러 상태 코드

| 상태 코드 | 사유 구절 | 의미 |
| --- | --- | --- |
| 500 | Internal Server Error | 서버가 요청을 처리할수 없게 만드는 에러를 만났을때 |
| 501 | Not Implemented | 클라이언트가 서버의 능력을 넘은 요청을 했을 때 |
| 502 | Bad Gateway | 프락시나 게이트웨이처럼 행동하는 서버가 잘못 되었을때 |
| 503 | Service Unavailable | 현재는 요청처리를 할숭 ㅓㅂㅅ지만 나중에는 가능함을 의미한다. |
| 504 | Gateway Timeout | 상태코드 408과 비슷 |
| 505 | HTTP Version Not Supported | 서버가 지원할 수 없거나 지원하지 않으려고 하는 버전의 프로토콜로 된 요청을 받았을 때 사용된다. |

## 헤더

- 일반 헤더

일반 헤더는 메시지에 대한 아주 기본적인 정보를 제공한다. 메시지가 어떤 종류이든 상관없이 유용한 정보 제공을 목적으로 하는 헤더들이다. 대표적으로 Date, MIME-Version 등이 있다.

- 요청 헤더

요청 메시지에서만 의미를 갖는 헤더 , 요청이 최초로 발생한 곳에서 클라이언트에 대한 정보를 제공한다.

- 응답 헤더

응답 메시지는 그들만의 응답 헤더를 갖는다. 이 헤더는 클라이언트에게 부가 정보를 제공하며응답에 대한 특별한 설명도 제공할 수 있다.

- 엔터티 헤더

HTTP 메시지의 엔터티 헤더는 요청과 응답 메시지 모두에게서 나타날 수 있다. 본문 내용물에 대한 , 광범위한 정보를 제공한다.

## Reference
